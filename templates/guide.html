{% extends "base.html" %}
{% block content %}
<style>
  /* Print styles for compact A4 layout */
  @media print {
    @page {
      size: A4;
      margin: 0.5cm;
      @bottom-center {
        content: "×¢××•×“ " counter(page) " ××ª×•×š " counter(pages);
        font-size: 8pt;
        color: #666;
      }
    }

    /* Page counter for browsers that don't support @page footer */
    .page-number::after {
      content: "×¢××•×“ " counter(page) " ××ª×•×š " counter(pages);
    }
    
    /* Hide navigation and controls */
    .no-print,
    .tabs input[type="radio"],
    .tabs label,
    .controls,
    .header-line .muted,
    button,
    form,
    #toggleStandbyBtn {
      display: none !important;
    }
    
    /* Show only the chains panel */
    .panel {
      display: none;
    }
    .panel-chains {
      display: block !important;
    }
    
    /* Compact layout */
    body {
      font-size: 9pt;
      line-height: 1.2;
      margin: 0;
      padding: 0;
    }
    
    .card {
      margin: 0;
      padding: 0;
      box-shadow: none;
      border: none;
    }
    
    /* Print header */
    .print-header {
      display: block !important;
      margin-bottom: 8px;
      padding-bottom: 4px;
      border-bottom: 2px solid #000;
    }
    
    /* Compact header */
    .header-line {
      display: none;
    }
    
    .section-title {
      font-size: 14pt;
      margin: 0;
    }
    
    /* Compact day headers */
    .day-header {
      font-size: 7pt !important;
      margin: 2px 0 1px 0 !important;
      padding: 0 !important;
      page-break-after: avoid;
    }
    
    /* Hide h2 title in print (only show print header) */
    .panel-chains h2 {
      display: none;
    }
    
    /* Compact tables */
    table {
      width: 100%;
      font-size: 6.5pt;
      border-collapse: collapse;
      margin-bottom: 3px;
      page-break-inside: avoid;
    }
    
    table th {
      padding: 1px 2px;
      font-size: 6.5pt;
      font-weight: bold;
      background: #e0e0e0 !important;
      border: 0.5px solid #000;
      text-align: center;
      line-height: 1.1;
    }
    
    table td {
      padding: 1px 2px;
      font-size: 6.5pt;
      border: 0.5px solid #ccc;
      text-align: center;
      line-height: 1.1;
    }
    
    /* Make table fit better */
    table th:nth-child(1),
    table td:nth-child(1) {
      width: 8%;
    }
    table th:nth-child(2),
    table td:nth-child(2) {
      width: 8%;
    }
    table th:nth-child(3),
    table td:nth-child(3) {
      width: 10%;
    }
    table th:nth-child(4),
    table td:nth-child(4) {
      width: 8%;
    }
    table th:nth-child(5),
    table td:nth-child(5) {
      width: 7%;
    }
    table th:nth-child(6),
    table td:nth-child(6) {
      width: 8%;
    }
    table th:nth-child(7),
    table td:nth-child(7) {
      width: 15%;
    }
    table th:nth-child(8),
    table td:nth-child(8),
    table th:nth-child(9),
    table td:nth-child(9),
    table th:nth-child(10),
    table td:nth-child(10),
    table th:nth-child(11),
    table td:nth-child(11),
    table th:nth-child(12),
    table td:nth-child(12) {
      width: 6%;
    }
    table th:nth-child(13),
    table td:nth-child(13) {
      width: 7%;
    }
    
    /* Summary row in table */
    .panel-chains table tbody tr:last-child {
      background-color: #e0e0e0 !important;
      font-weight: bold;
      border-top: 1px solid #000 !important;
      -webkit-print-color-adjust: exact;
      print-color-adjust: exact;
    }
    
    .panel-chains table tbody tr:last-child td {
      padding: 2px 3px;
      font-size: 6.5pt;
      font-weight: bold;
      border: 0.5px solid #000;
    }
    
    /* Compact cancelled standbys */
    .panel-chains > div > div[style*="background: #fef2f2"] {
      font-size: 5.5pt;
      padding: 1px 3px;
      margin-top: 1px;
      margin-bottom: 2px;
      line-height: 1.2;
    }
    
    /* Reduce spacing between days */
    .panel-chains .day-section {
      margin-bottom: 2px !important;
      page-break-inside: avoid;
    }
    
    /* Compact day headers in print */
    .panel-chains .day-header {
      font-size: 6pt !important;
      margin: 1px 0 0 0 !important;
      padding: 0 !important;
      line-height: 1.1;
    }
    
    /* Hide icons and emojis in print */
    span[title],
    .icon-arrow-up,
    .icon-break {
      display: none;
    }
    
    /* Remove emojis from print */
    .panel-chains *::before,
    .panel-chains *::after {
      content: none !important;
    }
    
    /* Ensure text fits */
    td {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    /* Compact segment details */
    td div {
      font-size: 6pt;
      line-height: 1.1;
      margin: 0;
      padding: 0;
    }
    
    /* Print-friendly colors */
    .row-standby {
      background-color: #f0f0f0 !important;
      -webkit-print-color-adjust: exact;
      print-color-adjust: exact;
    }
    
    .row-vacation {
      background-color: #e0f0f0 !important;
      -webkit-print-color-adjust: exact;
      print-color-adjust: exact;
    }
    
    /* Monthly summary */
    .panel-chains > div:last-child {
      margin-top: 8px;
      page-break-before: auto;
    }
    
    .panel-chains > div:last-child .day-header {
      font-size: 8pt !important;
      border-bottom: 1px solid #000 !important;
      padding-bottom: 2px !important;
      margin-bottom: 2px !important;
    }
    
    /* Page breaks */
    .panel-chains .day-section:nth-child(3n) {
      page-break-after: auto;
    }
  }
  
  /* Chain row styles */
  .row-standby {
    background-color: #f8f9fa;
    color: #6c757d;
  }
  .row-vacation {
    background-color: #e6fffa;
    color: #006644;
  }
  .cell-standby-active {
    background-color: #f0f9ff;
    color: #0369a1;
  }
  .cell-standby-cancelled {
    background-color: #fef2f2;
    color: #991b1b;
  }
  
  /* Screen styles for summary row */
  .panel-chains table tbody tr:last-child {
    background-color: #f2f4f7;
    font-weight: bold;
  }
  
  .panel-chains table tbody tr:last-child td {
    border-top: 2px solid #666;
    padding: 8px 6px;
  }
  
  /* Compact day headers on screen */
  .panel-chains .day-header {
    font-size: 10pt;
    margin-bottom: 4px;
    color: #333;
    font-weight: bold;
  }
  
  /* Reduce spacing between days on screen */
  .panel-chains .day-section {
    margin-bottom: 8px;
  }
</style>
<div class="card">
  <div class="header-line">
    <h2 class="section-title">{{ person['name'] }}</h2>
    <div class="muted">
      ×¡×•×’:
      {% if person['type'] == 'permanent' %}×§×‘×•×¢
      {% elif person['type'] == 'substitute' %}××—×œ×™×£
      {% else %}{{ person['type'] or '-' }}{% endif %}
      |
      ×˜×œ×¤×•×Ÿ: {{ person['phone'] or '-' }} |
      ××™××™×™×œ: {{ person['email'] or '-' }}
    </div>
  </div>

  <form method="get" class="controls no-print" style="margin: 12px 0;">
    <label for="month">×—×•×“×©:</label>
    <select id="month" name="month">
      {% for m in months %}
        <option value="{{ m.month }}" {% if m.month == selected_month and m.year == selected_year %}selected{% endif %}>{{ m.label }}</option>
      {% endfor %}
    </select>
    <label for="year">×©× ×”:</label>
    <select id="year" name="year">
      {% for y in years %}
        <option value="{{ y }}" {% if y == selected_year %}selected{% endif %}>{{ y }}</option>
      {% endfor %}
    </select>
    <button type="submit">×¢×“×›×Ÿ</button>
    {% if selected_month and selected_year %}
      <span class="muted">×—×•×“×© ××•×¦×’: {{ "%02d"|format(selected_month) }}/{{ selected_year }}</span>
    {% endif %}
  </form>

  <div class="tabs">
    <div class="no-print" style="background: #e7f5ff; border: 1px solid #bce3ff; padding: 12px 16px; border-radius: 8px; margin-bottom: 16px;">
      <h3 style="margin: 0 0 8px; color: #0056b3; font-size: 16px;">×¡×™×›×•× ×—×•×“×©×™:</h3>
      <div style="display: flex; gap: 24px; align-items: center; flex-wrap: wrap;">
        <div><strong>×¡×”"×› ×©×¢×•×ª ×¢×‘×•×“×”:</strong> {{ (monthly_totals.total_hours | float / 60) | round(2) }}</div>
        <div><strong>×¡×”"×› ×›×•× × ×•×™×•×ª:</strong> {{ total_standby_count }}</div>
        <div><strong>×¡×”"×› ×œ×ª×©×œ×•×:</strong> {{ "%.2f"|format((monthly_totals.payment or 0) + (monthly_totals.travel or 0) + (monthly_totals.extras or 0)) }}</div>
        <div style="height: 20px; border-left: 1px solid #bce3ff;"></div>
        <div>100%: {{ (monthly_totals.calc100 | float / 60) | round(2) }}</div>
        <div>125%: {{ (monthly_totals.calc125 | float / 60) | round(2) }}</div>
        <div>150%: {{ (monthly_totals.calc150 | float / 60) | round(2) }}</div>
        <div>175%: {{ (monthly_totals.calc175 | float / 60) | round(2) }}</div>
        <div>200%: {{ (monthly_totals.calc200 | float / 60) | round(2) }}</div>
      </div>
    </div>

    <input type="radio" id="tab-shifts" name="tabset" checked>
    <label for="tab-shifts">××©××¨×•×ª</label>
    <input type="radio" id="tab-chains" name="tabset">
    <label for="tab-chains">×¤×™×¨×•×˜ ×¨×¦×¤×™×</label>
    <input type="radio" id="tab-monthly" name="tabset">
    <label for="tab-monthly">×¡×™×›×•× ×—×•×“×©×™</label>
    <input type="radio" id="tab-merav" name="tabset">
    <label for="tab-merav">×™×™×¦×•× ×©×›×¨</label>
    <input type="radio" id="tab-simple" name="tabset">
    <label for="tab-simple">×—×™×©×•×‘ ×™×©×Ÿ</label>

    <div class="tab-panels">
      <section class="panel panel-simple">
        <h2 style="margin: 0 0 20px; font-size: 20px;">×¡×™×›×•× ×œ×¤×™ ×—×™×©×•×‘ ×™×©×Ÿ</h2>
        <table style="width: 100%; max-width: 600px; font-size: 1.1em;">
          <thead>
            <tr>
              <th>×¡×•×’</th>
              <th>×›××•×ª</th>
              <th>×¡×”"×› ×œ×ª×©×œ×•×</th>
            </tr>
          </thead>
          <tbody>
            <tr style="background-color: #f8f9fa;">
              <td>××©××¨×•×ª ×—×•×œ</td>
              <td>{{ simple_summary.weekday.count }}</td>
              <td>{{ simple_summary.weekday.payment | format_currency }}</td>
            </tr>
            <tr style="background-color: #fff3e0;">
              <td>××©××¨×•×ª ×©×™×©×™</td>
              <td>{{ simple_summary.friday.count }}</td>
              <td>{{ simple_summary.friday.payment | format_currency }}</td>
            </tr>
            <tr style="background-color: #e8f5e9;">
              <td>××©××¨×•×ª ×©×‘×ª</td>
              <td>{{ simple_summary.saturday.count }}</td>
              <td>{{ simple_summary.saturday.payment | format_currency }}</td>
            </tr>
            
            <tr style="color: #666; font-size: 0.9em; border-top: 1px dashed #ccc;">
              <td>××ª×•×›×Ÿ: ×©×¢×•×ª × ×•×¡×¤×•×ª (125%+)</td>
              <td>{{ simple_summary.overtime.hours | round(2) }} ×©×¢×•×ª</td>
              <td>{{ simple_summary.overtime.payment | format_currency }}</td>
            </tr>

            <tr style="font-weight: bold; border-top: 2px solid #333; font-size: 1.2em;">
              <td>×¡×”"×› ×œ×ª×©×œ×•× (×¢×‘×•×“×” ×‘×œ×‘×“)</td>
              <td>-</td>
              <td>{{ (simple_summary.weekday.payment + simple_summary.friday.payment + simple_summary.saturday.payment + simple_summary.overtime.payment) | format_currency }}</td>
            </tr>
          </tbody>
        </table>
        
        <div style="margin-top: 20px; font-size: 0.9em; color: #666;">
            * ×”×—×™×©×•×‘ ××¦×™×’ ×¡×™×›×•× ×œ×¤×™ ×¡×•×’ ×”×™×•× ×‘×• ×”×—×œ×” ×”××©××¨×ª (×—×•×œ, ×©×™×©×™, ×©×‘×ª).<br>
            * ×¡×›×•× ×”×ª×©×œ×•× ×‘×›×œ ×©×•×¨×” ×›×•×œ×œ ××ª ×¨×›×™×‘ ×”×‘×¡×™×¡ + ×ª×•×¡×¤×•×ª ×©×¢×•×ª × ×•×¡×¤×•×ª/×©×‘×ª.<br>
            * ×©×•×¨×ª "×©×¢×•×ª × ×•×¡×¤×•×ª" ××¦×™×’×” ×‘× ×¤×¨×“ ××ª ×¢×œ×•×ª ×”×©×¢×•×ª ×”× ×•×¡×¤×•×ª ×©× ×›×œ×œ×• ×‘×—×™×©×•×‘.
        </div>
      </section>
      <section class="panel panel-shifts">
        {% if reports %}
        <table>
          <thead>
            <tr>
              <th>×ª××¨×™×š</th>
              <th>×ª×—×œ×”</th>
              <th>×¡×™×•×</th>
              <th>×¡×•×’ ××©××¨×ª</th>
              <th>×“×™×¨×”</th>
              <th>××™×©×•×¨</th>
              <th>×”×–×›××•×ª ×œ×ª×©×œ×•×</th>
            </tr>
          </thead>
          <tbody>
            {% for shift in shift_segments %}
            <tr>
              <td>{{ shift['report']['date']|human_date }}</td>
              <td>{{ shift['report']['start_time'] or '-' }}</td>
              <td>{{ shift['report']['end_time'] or '-' }}</td>
              <td>{{ shift['report']['shift_name'] or shift['report']['shift_type'] or '-' }}</td>
              <td>{{ shift['report']['apartment_name'] or shift['report']['apartment_id'] or '-' }}</td>
              <td>{{ '×××•×©×¨' if shift['report']['is_approved'] else '×××ª×™×Ÿ' }}</td>
              <td>{{ "%.2f"|format(shift['payment']) }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
        {% else %}
          <div class="muted">××™×Ÿ ××©××¨×•×ª ×œ×—×•×“×© ×–×”.</div>
        {% endif %}
      </section>

      <section class="panel panel-chains">
        <div class="print-header" style="display: none;">
          <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 4px;">
            <div style="font-size: 8pt; color: #666;">×’×¨×¡×” {{ app_version }}</div>
            <div style="font-size: 8pt; color: #666;" class="page-number"></div>
          </div>
          <h1 style="margin: 0; font-size: 16pt; text-align: center;">×“×•×— ×¤×™×¨×•×˜ ×¨×¦×¤×™× - {{ person['name'] }}</h1>
          <div style="text-align: center; font-size: 10pt; margin: 4px 0;">×—×•×“×©: {{ "%02d"|format(selected_month) }}/{{ selected_year }}</div>
        </div>
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
          <h2 style="margin: 0; font-size: 20px;">×“×•×— ×¤×™×¨×•×˜ ×¨×¦×¤×™×</h2>
          <div style="display: flex; gap: 8px;">
            <button type="button" id="toggleStandbyBtn" onclick="toggleStandby()" style="background: #6c757d; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer;">×”×¡×ª×¨ ×›×•× × ×•×™×•×ª</button>
            <button type="button" onclick="window.print()" class="no-print" style="background: #007bff; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer;">ğŸ–¨ï¸ ×”×“×¤×¡ ×“×•×—</button>
          </div>
        </div>
        {% if daily_segments %}
        {% for day in daily_segments %}
          {% if day.chains and day.chains|length > 0 %}
          <div class="day-section" style="margin-bottom: 8px;">
            <div class="day-header" style="margin-bottom: 4px; font-size: 9pt; color: #333; font-weight: bold;">
              {{ day.day }} ({{ day.day_name }}, {{ day.hebrew_date }})
            </div>
            <table>
              <thead>
                <tr>
                  <th>×ª×—×™×œ×ª ×¨×¦×£</th>
                  <th>×¡×™×•× ×¨×¦×£</th>
                  <th>×“×™×¨×”</th>
                  <th>×¡×•×’</th>
                  <th>×¡×”"×› ×©×¢×•×ª</th>
                  <th>×ª×©×œ×•× ×¢×‘×•×“×”</th>
                  <th>×¤×™×¨×•×˜ ××§×˜×¢×™×</th>
                  <th>100% ××—×•×©×‘</th>
                  <th>125% ××—×•×©×‘</th>
                  <th>150% ××—×•×©×‘</th>
                  <th>175% ××—×•×©×‘</th>
                  <th>200% ××—×•×©×‘</th>
                  <th>×”×¢×¨×•×ª / ×¡×™×‘×” ×œ×©×‘×™×¨×”</th>
                </tr>
              </thead>
              <tbody>
                {% for chain in day.chains %}
                <tr class="{% if chain.type == 'standby' %}row-standby{% elif chain.type == 'vacation' %}row-vacation{% endif %}">
                  <td>
                    {{ chain.start_time }}
                    {% if chain.from_prev_day %}
                      <span title="×”××©×š ×××ª××•×œ" style="cursor: help;">â®ï¸</span>
                    {% endif %}
                  </td>
                  <td>{{ chain.end_time }}</td>
                  <td style="font-size: 0.85em; color: #666;">{{ chain.apartment_name or '-' }}</td>
                  <td>
                    {% if chain.type == 'standby' %}
                      <strong>×›×•× × ×•×ª</strong>
                    {% elif chain.type == 'vacation' %}
                      <strong>×—×•×¤×©×”</strong>
                    {% else %}
                      ×¢×‘×•×“×”
                    {% endif %}
                  </td>
                  <td>{{ (chain.total_minutes | float / 60) | round(2) }}</td>
                  <td>
                    {% if chain.type == 'standby' %}
                      -
                    {% else %}
                      {{ "%.2f"|format(chain.payment) }}
                    {% endif %}
                  </td>
                  
                  {# ×¢××•×“×ª ×¤×™×¨×•×˜ ××§×˜×¢×™× #}
                  <td style="font-size: 0.9em;">
                    {% if chain.type == 'standby' %}
                      -
                    {% else %}
                      {% for seg_start, seg_end, seg_label in chain.segments %}
                        <div style="white-space: nowrap;">
                          {{ seg_start }}-{{ seg_end }} 
                          <span style="color: #666;">({{ seg_label }})</span>
                        </div>
                      {% endfor %}
                    {% endif %}
                  </td>

                  {% if chain.type == 'standby' %}
                    <td>-</td>
                    <td>-</td>
                    <td>-</td>
                    <td>-</td>
                    <td>-</td>
                  {% elif chain.type == 'vacation' %}
                     <td colspan="5" style="text-align: center; color: #999;">-</td>
                  {% else %}
                    <td>{{ (chain.calc100 | float / 60) | round(2) }}</td>
                    <td>{{ (chain.calc125 | float / 60) | round(2) }}</td>
                    <td>{{ (chain.calc150 | float / 60) | round(2) }}</td>
                    <td>{{ (chain.calc175 | float / 60) | round(2) }}</td>
                    <td>{{ (chain.calc200 | float / 60) | round(2) }}</td>
                  {% endif %}

                  <td>
                    {% if chain.break_reason and chain.break_reason != '×›×•× × ×•×ª' and chain.break_reason != '×—×•×¤×©×”' %}
                      {{ chain.break_reason }}
                    {% endif %}
                  </td>
                </tr>
                {% endfor %}
                <!-- ×©×•×¨×ª ×¡×™×›×•× ×™×•××™ -->
                <tr style="background-color: #f2f4f7; font-weight: bold; border-top: 2px solid #666;">
                  <td colspan="3" style="text-align: right; padding: 4px 6px;">
                    <strong>×¡×™×›×•×:</strong>
                  </td>
                  <td style="text-align: center; padding: 4px 6px; font-weight: bold; font-size: 0.9em;">
                    {{ "%.2f"|format((day.payment or 0) + (day.standby_payment or 0)) }}
                  </td>
                  <td style="text-align: center; padding: 4px 6px;">
                    {{ (day.total_minutes_no_standby | float / 60) | round(2) }}
                  </td>
                  <td style="text-align: center; padding: 4px 6px; font-size: 0.85em;">
                    {{ "%.2f"|format(day.payment or 0) }}
                  </td>
                  <td style="text-align: center; padding: 4px 6px; font-size: 0.85em;">
                    {{ "%.2f"|format(day.standby_payment or 0) }}
                  </td>
                  <td style="text-align: center; padding: 4px 6px;">{{ (day.calc100 | float / 60) | round(2) }}</td>
                  <td style="text-align: center; padding: 4px 6px;">{{ (day.calc125 | float / 60) | round(2) }}</td>
                  <td style="text-align: center; padding: 4px 6px;">{{ (day.calc150 | float / 60) | round(2) }}</td>
                  <td style="text-align: center; padding: 4px 6px;">{{ (day.calc175 | float / 60) | round(2) }}</td>
                  <td style="text-align: center; padding: 4px 6px;">{{ (day.calc200 | float / 60) | round(2) }}</td>
                  <td style="text-align: center; padding: 4px 6px;">-</td>
                </tr>
              </tbody>
            </table>
            {% if day.cancelled_standbys and day.cancelled_standbys|length > 0 %}
            <div class="no-print" style="margin-top: 8px; padding: 8px; background: #fef2f2; border: 1px solid #fecaca; border-radius: 6px; font-size: 13px; color: #991b1b;">
              <strong>âš ï¸ ×›×•× × ×•×ª ×‘×•×˜×œ×”:</strong>
              {% for cs in day.cancelled_standbys %}
                ×›×•× × ×•×ª {{ cs.start // 60 }}:{{ "%02d"|format(cs.start % 60) }}-{{ cs.end // 60 }}:{{ "%02d"|format(cs.end % 60) }} 
                ×‘×•×˜×œ×” ×¢×§×‘ {{ cs.reason }}
                {% if not loop.last %} | {% endif %}
              {% endfor %}
            </div>
            {% endif %}
          </div>
          {% endif %}
        {% endfor %}
        
        <!-- ×¡×™×›×•× ×—×•×“×©×™ -->
        {% if daily_segments %}
        <div style="margin-top: 16px; page-break-before: auto;">
          <div class="day-header" style="margin-bottom: 4px; font-size: 10pt; color: #000; font-weight: bold; border-bottom: 2px solid #000;">
            ×¡×™×›×•× ×—×•×“×©×™ - {{ person['name'] }}
          </div>
          <table>
            <thead>
              <tr>
                <th>×ª×—×™×œ×ª ×¨×¦×£</th>
                <th>×¡×™×•× ×¨×¦×£</th>
                <th>×“×™×¨×”</th>
                <th>×¡×•×’</th>
                <th>×¡×”"×› ×©×¢×•×ª</th>
                <th>×ª×©×œ×•× ×¢×‘×•×“×”</th>
                <th>×¤×™×¨×•×˜ ××§×˜×¢×™×</th>
                <th>100% ××—×•×©×‘</th>
                <th>125% ××—×•×©×‘</th>
                <th>150% ××—×•×©×‘</th>
                <th>175% ××—×•×©×‘</th>
                <th>200% ××—×•×©×‘</th>
                <th>×”×¢×¨×•×ª / ×¡×™×‘×” ×œ×©×‘×™×¨×”</th>
              </tr>
            </thead>
            <tbody>
              <tr style="background-color: #e0e0e0; font-weight: bold; border-top: 2px solid #000;">
                <td colspan="3" style="text-align: right; padding: 6px 8px;">
                  <strong>×¡×™×›×•× ×—×•×“×©×™:</strong>
                </td>
                <td style="text-align: center; padding: 6px 8px; font-weight: bold;">
                  {{ "%.2f"|format((monthly_totals.payment or 0) + (monthly_totals.travel or 0) + (monthly_totals.extras or 0)) }}
                </td>
                <td style="text-align: center; padding: 6px 8px;">
                  {{ (monthly_totals.total_hours | float / 60) | round(2) }}
                </td>
                <td style="text-align: center; padding: 6px 8px;">
                  {{ "%.2f"|format((monthly_totals.payment or 0) - (monthly_totals.standby_payment or 0)) }}
                </td>
                <td style="text-align: center; padding: 6px 8px; font-size: 0.85em;">
                  {{ "%.2f"|format(monthly_totals.standby_payment or 0) }}
                  {% if monthly_totals.travel or monthly_totals.extras %}
                    {% if monthly_totals.travel %}
                      | × ×¡×™×¢×•×ª: {{ "%.2f"|format(monthly_totals.travel or 0) }}
                    {% endif %}
                    {% if monthly_totals.extras %}
                      | ×ª×•×¡×¤×•×ª: {{ "%.2f"|format(monthly_totals.extras or 0) }}
                    {% endif %}
                  {% endif %}
                </td>
                <td style="text-align: center; padding: 6px 8px;">{{ (monthly_totals.calc100 | float / 60) | round(2) }}</td>
                <td style="text-align: center; padding: 6px 8px;">{{ (monthly_totals.calc125 | float / 60) | round(2) }}</td>
                <td style="text-align: center; padding: 6px 8px;">{{ (monthly_totals.calc150 | float / 60) | round(2) }}</td>
                <td style="text-align: center; padding: 6px 8px;">{{ (monthly_totals.calc175 | float / 60) | round(2) }}</td>
                <td style="text-align: center; padding: 6px 8px;">{{ (monthly_totals.calc200 | float / 60) | round(2) }}</td>
                <td style="text-align: center; padding: 6px 8px;">-</td>
              </tr>
            </tbody>
          </table>
        </div>
        {% endif %}
        
        {% else %}
          <div class="muted">××™×Ÿ × ×ª×•× ×™× ×œ×—×•×“×© ×”× ×‘×—×¨.</div>
        {% endif %}
      </section>

      <section class="panel panel-monthly">
        <h2 style="margin: 0 0 20px; font-size: 20px;">×¡×™×›×•× ×—×•×“×©×™ ××¨×•×›×–</h2>
        <div style="margin-bottom: 20px; padding: 15px; background-color: #f8f9fa; border-radius: 8px; border: 1px solid #dee2e6;">
           <div style="font-size: 16px; font-weight: bold; margin-bottom: 10px;">×¡×”"×› ×›×•× × ×•×™×•×ª ×—×•×“×©×™: {{ total_standby_count }}</div>
           {% set total_cancelled = daily_segments | selectattr('cancelled_standbys') | map(attribute='cancelled_standbys') | map('length') | sum %}
           {% if total_cancelled > 0 %}
           <div style="font-size: 14px; margin-bottom: 10px; color: #dc2626;">
             âŒ ×›×•× × ×•×™×•×ª ×©×‘×•×˜×œ×• (×—×¤×™×¤×” ××¢×œ 70%): <strong>{{ total_cancelled }}</strong>
           </div>
           {% endif %}
           <div style="font-size: 16px; font-weight: bold; margin-bottom: 10px; color: #6c757d;">×ª×©×œ×•× ×›×•× × ×•×™×•×ª: {{ (monthly_totals.standby_payment or 0) | format_currency }} â‚ª</div>
           <div style="font-size: 16px; font-weight: bold; color: #1f6feb;">×¡×”"×› ×œ×ª×©×œ×•× (×¢×‘×•×“×” ×‘×œ×‘×“): {{ (monthly_totals.payment or 0) | format_currency }} â‚ª</div>
        </div>
        {% if daily_segments %}
        <table>
          <thead>
            <tr>
              <th>×ª××¨×™×š</th>
              <th>×™×•×</th>
              <th>×¡×”"×› ×©×¢×•×ª</th>
              <th>×›×•× × ×•×ª</th>
              <th>×¡×”"×› ×œ×ª×©×œ×•×</th>
              <th>100%</th>
              <th>125%</th>
              <th>150%</th>
              <th>175%</th>
              <th>200%</th>
            </tr>
          </thead>
          <tbody>
            {% for day in daily_segments %}
            <tr>
              <td>{{ day.day }}</td>
              <td>{{ day.day_name }}</td>
              <td>{{ (day.total_minutes_no_standby | float / 60) | round(2) }}</td>
              <td class="{% if day.standby_payment and day.standby_payment > 0 %}cell-standby-active{% elif day.cancelled_standbys and day.cancelled_standbys|length > 0 %}cell-standby-cancelled{% endif %}">
                {% if day.standby_payment and day.standby_payment > 0 %}
                  {{ "%.2f"|format(day.standby_payment) }}
                {% elif day.cancelled_standbys and day.cancelled_standbys|length > 0 %}
                  <span title="×›×•× × ×•×ª ×‘×•×˜×œ×” ×¢×§×‘ ×—×¤×™×¤×” ××¢×œ 70% ×¢× ×¢×‘×•×“×”" style="cursor: help;">
                    âŒ ×‘×•×˜×œ ({{ day.cancelled_standbys|length }})
                  </span>
                {% else %}
                  -
                {% endif %}
              </td>
              <td>{{ "%.2f"|format(day.payment or 0) }}</td>
              <td>{{ (day.calc100 | float / 60) | round(2) }}</td>
              <td>{{ (day.calc125 | float / 60) | round(2) }}</td>
              <td>{{ (day.calc150 | float / 60) | round(2) }}</td>
              <td>{{ (day.calc175 | float / 60) | round(2) }}</td>
              <td>{{ (day.calc200 | float / 60) | round(2) }}</td>
            </tr>
            {% endfor %}
            <tr style="background-color: #e7f5ff; font-weight: bold; border-top: 2px solid #bce3ff;">
              <td colspan="2">×¡×”"×› ×›×œ×œ×™</td>
              <td>{{ (monthly_totals.total_hours | float / 60) | round(2) }}</td>
              <td style="background-color: #dbeafe;">{{ (monthly_totals.standby_payment or 0) | format_currency }}</td>
              <td>{{ "%.2f"|format(monthly_totals.payment or 0) }}</td>
              <td>{{ (monthly_totals.calc100 | float / 60) | round(2) }}</td>
              <td>{{ (monthly_totals.calc125 | float / 60) | round(2) }}</td>
              <td>{{ (monthly_totals.calc150 | float / 60) | round(2) }}</td>
              <td>{{ (monthly_totals.calc175 | float / 60) | round(2) }}</td>
              <td>{{ (monthly_totals.calc200 | float / 60) | round(2) }}</td>
            </tr>
          </tbody>
        </table>
        {% else %}
          <div class="muted">××™×Ÿ × ×ª×•× ×™× ×œ×—×•×“×© ×”× ×‘×—×¨.</div>
        {% endif %}
      </section>

      <section class="panel panel-merav">
        <h2 style="margin: 0 0 20px; font-size: 20px;">×™×™×¦×•× ×©×›×¨ ×•× ×ª×•× ×™×</h2>
        
        <!-- ×›×¤×ª×•×¨ ×™×™×¦×•× ×œ×’×©×¨ -->
        <div style="margin-bottom: 20px; padding: 16px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 8px;">
          <div style="display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 12px;">
            <div style="color: white;">
              <strong style="font-size: 16px;">ğŸ“¤ ×™×™×¦×•× ×§×•×‘×¥ ×’×©×¨ ×œ×¢×•×‘×“ ×–×”</strong>
              <div style="font-size: 13px; opacity: 0.9;">×”×•×¨×“ ×§×•×‘×¥ .mrv ×œ×™×™×‘×•× ×œ××¢×¨×›×ª ××™×¨×‘</div>
            </div>
            <a href="/export/gesher/person/{{ person.id }}?year={{ selected_year }}&month={{ selected_month }}" 
               class="button" 
               style="background: white; color: #667eea; text-decoration: none; padding: 10px 20px; border-radius: 6px; font-weight: bold;">
              ğŸ“¥ ×”×•×¨×“ ×§×•×‘×¥ ×’×©×¨
            </a>
          </div>
        </div>
        
        {% if daily_segments %}
        {% set hourly_rate = minimum_wage %}
        
        {# Create a lookup map for payment codes #}
        {% set codes_map = {} %}
        {% if payment_codes %}
            {% for c in payment_codes %}
                {% set _ = codes_map.update({c.internal_key: c.merav_code}) %}
            {% endfor %}
        {% endif %}
        
        <!-- ×˜×‘×œ×” ××™× ×¤×•×¨××˜×™×‘×™×ª -->
        <div style="margin-bottom: 24px; background: #fff; border: 1px solid #e1e4e8; border-radius: 6px; padding: 16px;">
            <h3 style="margin-top: 0; font-size: 16px; color: #24292e;">× ×ª×•× ×™× ×›×œ×œ×™×™× ×•×¦×‘×™×¨×•×ª (×—×•×“×©×™)</h3>
            <table style="width: 100%; max-width: 600px; margin-top: 10px;">
                <thead>
                    <tr style="background-color: #f6f8fa;">
                        <th style="text-align: right;">× ×ª×•×Ÿ</th>
                        <th style="text-align: center;">×§×•×“ ××™×¨×‘</th>
                        <th style="text-align: left;">×¢×¨×š</th>
                    </tr>
                </thead>
                <tbody>
                    {% if payment_codes %}
                    {% for code in payment_codes %}
                    {% if code.display_order >= 200 %}
                        {% set key = code.internal_key %}
                        {% set val = monthly_totals[key] %}
                        <tr>
                            <td>
                                {{ code.display_name }}
                                {% if key == 'sick_days_accrued' %}
                                    <div style="font-size: 0.8em; color: #666; font-weight: normal;">
                                        (×œ×¤×™ {{ monthly_totals.actual_work_days }} ×™××™ ×¢×‘×•×“×” / 21.66 * 1.5)
                                    </div>
                                {% elif key == 'vacation_days_accrued' %}
                                    <div style="font-size: 0.8em; color: #666; font-weight: normal;">
                                        (×•×ª×§: ×©× ×” {{ monthly_totals.vacation_details.seniority }}, ×–×›××•×ª ×©× ×ª×™×ª: {{ monthly_totals.vacation_details.annual_quota }}, ×”×™×§×£: {{ monthly_totals.vacation_details.job_scope_pct }}%)
                                    </div>
                                {% endif %}
                            </td>
                            <td style="text-align: center;">{{ code.merav_code or '' }}</td>
                            <td style="text-align: left; font-weight: bold;">
                                {% if key == 'actual_work_days' or key == 'vacation_days_taken' or key == 'sick_days_taken' %}
                                    {{ val }}
                                {% elif key == 'total_hours' %}
                                    {{ (val | float / 60) | round(2) }}
                                {% else %}
                                    {{ "%.2f"|format(val or 0) }}
                                {% endif %}
                            </td>
                        </tr>
                    {% endif %}
                    {% endfor %}
                    {% else %}
                    <tr>
                        <td>×¡×”"×› ×™××™ ×¢×‘×•×“×” ×‘×¤×•×¢×œ (×§×œ× ×“×¨×™×™×)</td>
                        <td style="text-align: center;"></td>
                        <td style="text-align: left; font-weight: bold;">{{ monthly_totals.actual_work_days }}</td>
                    </tr>
                    <tr>
                        <td>×¡×”"×› ×©×¢×•×ª ×œ×ª×©×œ×•× (×œ×œ× ×›×•× × ×•×ª)</td>
                        <td style="text-align: center;"></td>
                        <td style="text-align: left; font-weight: bold;">{{ (monthly_totals.total_hours | float / 60) | round(2) }}</td>
                    </tr>
                    <tr>
                        <td>
                            ×–×›××•×ª ×™××™ ××—×œ×” (×—×•×“×©×™×ª)
                            <div style="font-size: 0.8em; color: #666; font-weight: normal;">
                                (×œ×¤×™ {{ monthly_totals.actual_work_days }} ×™××™ ×¢×‘×•×“×” / 21.66 * 1.5)
                            </div>
                        </td>
                        <td style="text-align: center;"></td>
                        <td style="text-align: left; font-weight: bold; color: #0366d6;">{{ "%.2f"|format(monthly_totals.sick_days_accrued) }}</td>
                    </tr>
                    <tr>
                        <td>
                            ×–×›××•×ª ×™××™ ×—×•×¤×©×” (×—×•×“×©×™×ª)
                            <div style="font-size: 0.8em; color: #666; font-weight: normal;">
                                (×•×ª×§: ×©× ×” {{ monthly_totals.vacation_details.seniority }}, ×–×›××•×ª ×©× ×ª×™×ª: {{ monthly_totals.vacation_details.annual_quota }}, ×”×™×§×£: {{ monthly_totals.vacation_details.job_scope_pct }}%)
                            </div>
                        </td>
                        <td style="text-align: center;"></td>
                        <td style="text-align: left; font-weight: bold; color: #28a745;">{{ "%.2f"|format(monthly_totals.vacation_days_accrued) }}</td>
                    </tr>
                    <tr>
                        <td>× ×™×¦×•×œ ×™××™ ×—×•×¤×©×” (×‘×¤×•×¢×œ)</td>
                        <td style="text-align: center;"></td>
                        <td style="text-align: left; font-weight: bold; color: #d73a49;">{{ monthly_totals.vacation_days_taken }}</td>
                    </tr>
                    {% endif %}
                </tbody>
            </table>
        </div>

        <h3 style="margin: 0 0 12px; font-size: 16px; color: #24292e;">×¤×™×¨×•×˜ ×¨×›×™×‘×™ ×©×›×¨ ×œ×ª×©×œ×•×</h3>
        {% set total_cancelled = daily_segments | selectattr('cancelled_standbys') | map(attribute='cancelled_standbys') | map('length') | sum %}
        <table style="max-width: 700px;">
          <thead>
            <tr>
              <th>×ª×™××•×¨ ×¨×›×™×‘</th>
              <th>×§×•×“ ××™×¨×‘</th>
              <th>×›××•×ª (×©×¢×•×ª/×™×—×™×“×•×ª)</th>
              <th>×ª×¢×¨×™×£ / ××—×•×–</th>
              <th>×¡×”"×› ×œ×ª×©×œ×•×</th>
            </tr>
          </thead>
          <tbody>
            {# ×©×•×¨×•×ª ×©×‘×ª ××¤×•×¦×œ×•×ª - ×‘×¡×™×¡ 100% ×•×ª×•×¡×¤×ª 50% #}
            {% if monthly_totals.calc150_shabbat_100 and monthly_totals.calc150_shabbat_100 > 0 %}
            <tr style="background-color: #e8f5e9;">
                <td>×©×¢×•×ª ×©×‘×ª - ×‘×¡×™×¡ (100%)</td>
                <td>{{ codes_map.get('calc150_shabbat_100', '') }}</td>
                <td>{{ (monthly_totals.calc150_shabbat_100 | float / 60) | round(2) }}</td>
                <td>{{ "%.2f"|format(hourly_rate * 1.0) }} â‚ª</td>
                <td>{{ ((monthly_totals.calc150_shabbat_100 | float / 60) * hourly_rate * 1.0) | format_currency }}</td>
            </tr>
            <tr style="background-color: #fff3e0;">
                <td>×©×¢×•×ª ×©×‘×ª - ×ª×•×¡×¤×ª (50%)</td>
                <td>{{ codes_map.get('calc150_shabbat_50', '') }}</td>
                <td>{{ (monthly_totals.calc150_shabbat_50 | float / 60) | round(2) }}</td>
                <td>{{ "%.2f"|format(hourly_rate * 0.5) }} â‚ª</td>
                <td>{{ ((monthly_totals.calc150_shabbat_50 | float / 60) * hourly_rate * 0.5) | format_currency }}</td>
            </tr>
            {% endif %}
            
            {% if payment_codes %}
            {% for code in payment_codes if code.display_order < 200 %}
                {% set key = code.internal_key %}
                {% set val = monthly_totals[key] or 0 %}
                
                {# ×“×™×œ×•×’ ×¢×œ ×©×¢×•×ª ×©×‘×ª 150% - ×›×‘×¨ ×”×¦×’× ×• ××•×ª×Ÿ ××¤×•×¦×œ×•×ª ×œ××¢×œ×” #}
                {% if key == 'calc150_shabbat' or key == 'calc150_shabbat_100' or key == 'calc150_shabbat_50' %}
                    {# skip - already shown as split rows above #}
                {% elif val > 0 %}
                    <tr>
                        <td>{{ code.display_name }}</td>
                        <td>{{ code.merav_code or '' }}</td>
                        
                        {% if key == 'standby' %}
                            {% set net_count = val - total_cancelled %}
                            <td>{{ net_count }}</td>
                            <td>
                                {% if net_count > 0 %}
                                    {{ "%.2f"|format((monthly_totals.standby_payment or 0) / net_count) }} â‚ª
                                {% else %}
                                    0.00 â‚ª
                                {% endif %}
                            </td>
                            <td>{{ (monthly_totals.standby_payment or 0) | format_currency }}</td>
                        {% elif key == 'vacation' %}
                             <td>{{ (val | float / 60) | round(2) }}</td>
                             <td>{{ "%.2f"|format(hourly_rate) }} â‚ª</td>
                             <td>{{ monthly_totals.vacation_payment | format_currency }}</td>
                        {% elif key == 'travel' %}
                            {# × ×¡×™×¢×•×ª - ×¡×›×•× ×™×©×™×¨ ×‘×©×§×œ×™×, ×œ× ×©×¢×•×ª #}
                            <td>-</td>
                            <td>-</td>
                            <td>{{ val | format_currency }}</td>
                        {% elif key == 'extras' %}
                            {# ×ª×•×¡×¤×•×ª - ×¡×›×•× ×™×©×™×¨ ×‘×©×§×œ×™× #}
                            <td>-</td>
                            <td>-</td>
                            <td>{{ val | format_currency }}</td>
                        {% elif key == 'calc_variable' %}
                            {# ×©×¢×•×ª ×‘×ª×¢×¨×™×£ ××©×ª× ×” - ×ª×¢×¨×™×£ ×©×•× ×” ××©×›×¨ ××™× ×™××•× #}
                            <td>{{ (val | float / 60) | round(2) }}</td>
                            <td>{{ "%.2f"|format(monthly_totals.variable_rate_value or 0) }} â‚ª</td>
                            <td>{{ (monthly_totals.payment_calc_variable or 0) | format_currency }}</td>
                        {% else %}
                            <td>{{ (val | float / 60) | round(2) }}</td>

                            {% set multiplier = 1.0 %}
                            {% if '125' in key %}{% set multiplier = 1.25 %}
                            {% elif '150' in key %}{% set multiplier = 1.5 %}
                            {% elif '175' in key %}{% set multiplier = 1.75 %}
                            {% elif '200' in key %}{% set multiplier = 2.0 %}
                            {% endif %}

                            {# For regular hours, always use minimum wage #}
                            <td>{{ "%.2f"|format(hourly_rate * multiplier) }} â‚ª</td>
                            {% set payment_key = 'payment_' ~ key %}
                            {% if monthly_totals[payment_key] is defined and monthly_totals[payment_key] > 0 %}
                            <td>{{ monthly_totals[payment_key] | format_currency }}</td>
                            {% else %}
                            <td>{{ ((val | float / 60) * hourly_rate * multiplier) | format_currency }}</td>
                            {% endif %}
                        {% endif %}
                    </tr>
                {% endif %}
            {% endfor %}
            {% endif %}
            {% if not payment_codes %}
            <!-- 100% -->
            <tr>
              <td>×©×¢×•×ª ×¨×’×™×œ×•×ª (100%)</td>
              <td>{{ codes_map.get('calc100', '') }}</td>
              <td>{{ (monthly_totals.calc100 | float / 60) | round(2) }}</td>
              <td>34.40 â‚ª</td>
              <td>{{ ((monthly_totals.calc100 | float / 60) * hourly_rate * 1.0) | format_currency }}</td>
            </tr>
            <!-- 125% -->
            <tr>
              <td>×©×¢×•×ª × ×•×¡×¤×•×ª (125%)</td>
              <td>{{ codes_map.get('calc125', '') }}</td>
              <td>{{ (monthly_totals.calc125 | float / 60) | round(2) }}</td>
              <td>43.00 â‚ª</td>
              <td>{{ ((monthly_totals.calc125 | float / 60) * hourly_rate * 1.25) | format_currency }}</td>
            </tr>
            <!-- 150% overtime (not Shabbat) -->
            <tr>
              <td>×©×¢×•×ª × ×•×¡×¤×•×ª (150%)</td>
              <td>{{ codes_map.get('calc150_overtime', '') }}</td>
              <td>{{ (monthly_totals.calc150_overtime | float / 60) | round(2) }}</td>
              <td>{{ "%.2f"|format(hourly_rate * 1.5) }} â‚ª</td>
              <td>{{ ((monthly_totals.calc150_overtime | float / 60) * hourly_rate * 1.5) | format_currency }}</td>
            </tr>
            <!-- 175% -->
            <tr>
              <td>×©×¢×•×ª ×©×‘×ª (175%)</td>
              <td>{{ codes_map.get('calc175', '') }}</td>
              <td>{{ (monthly_totals.calc175 | float / 60) | round(2) }}</td>
              <td>60.20 â‚ª</td>
              <td>{{ ((monthly_totals.calc175 | float / 60) * hourly_rate * 1.75) | format_currency }}</td>
            </tr>
            <!-- 200% -->
            <tr>
              <td>×©×¢×•×ª ×©×‘×ª (200%)</td>
              <td>{{ codes_map.get('calc200', '') }}</td>
              <td>{{ (monthly_totals.calc200 | float / 60) | round(2) }}</td>
              <td>68.80 â‚ª</td>
              <td>{{ ((monthly_totals.calc200 | float / 60) * hourly_rate * 2.0) | format_currency }}</td>
            </tr>
            
            <!-- ×›×•× × ×•×™×•×ª -->
            {% if total_standby_count > 0 %}
            <tr style="background-color: #f8f9fa;">
              <td>×›×•× × ×•×™×•×ª</td>
              <td>{{ codes_map.get('standby', '') }}</td>
              <td>{{ total_standby_count }}</td>
              <td>
                {% if total_standby_count > 0 %}
                    {{ "%.2f"|format((monthly_totals.standby_payment or 0) / total_standby_count) }} â‚ª
                {% else %}
                    0.00 â‚ª
                {% endif %}
              </td>
              <td>{{ (monthly_totals.standby_payment or 0) | format_currency }}</td>
            </tr>
            {% endif %}
            
            <!-- ×—×•×¤×©×” -->
            {% if monthly_totals.vacation_minutes and monthly_totals.vacation_minutes > 0 %}
            <tr style="background-color: #e6fffa;">
              <td>×—×•×¤×©×”</td>
              <td>{{ codes_map.get('vacation', '') }}</td>
              <td>{{ (monthly_totals.vacation_minutes | float / 60) | round(2) }}</td>
              <td>{{ hourly_rate }} â‚ª</td>
              <td>{{ monthly_totals.vacation_payment | format_currency }}</td>
            </tr>
            {% endif %}
            
            <!-- × ×¡×™×¢×•×ª -->
            {% if monthly_totals.travel and monthly_totals.travel > 0 %}
            <tr style="background-color: #fef3c7;">
              <td>ğŸš— × ×¡×™×¢×•×ª</td>
              <td>{{ codes_map.get('travel', '') }}</td>
              <td>-</td>
              <td>-</td>
              <td>{{ monthly_totals.travel | format_currency }}</td>
            </tr>
            {% endif %}
            
            <!-- ×ª×•×¡×¤×•×ª/×”×—×–×¨×™× -->
            {% if monthly_totals.extras and monthly_totals.extras > 0 %}
            <tr style="background-color: #fce7f3;">
              <td>ğŸ’° ×ª×•×¡×¤×•×ª/×”×—×–×¨×™×</td>
              <td>{{ codes_map.get('extras', '') }}</td>
              <td>-</td>
              <td>
                {% if monthly_totals.extras_details %}
                  <span style="font-size: 11px; color: #666;">
                    {% for ed in monthly_totals.extras_details %}
                      {{ ed.type }}{% if not loop.last %}, {% endif %}
                    {% endfor %}
                  </span>
                {% endif %}
              </td>
              <td>{{ monthly_totals.extras | format_currency }}</td>
            </tr>
            {% endif %}
            {% endif %}

            <tr style="font-weight: bold; border-top: 2px solid #333; background-color: #e7f5ff;">
              <td>×¡×”"×› ×œ×ª×©×œ×•×</td>
              <td></td>
              <td>-</td>
              <td>-</td>
              <td>{{ ((monthly_totals.payment or 0) + (monthly_totals.travel or 0) + (monthly_totals.extras or 0)) | format_currency }}</td>
            </tr>
          </tbody>
        </table>
        <div class="muted" style="margin-top: 10px;">
          * ×”×—×™×©×•×‘ ××‘×•×¡×¡ ×¢×œ ×©×›×¨ ×©×¢×” ×©×œ {{ hourly_rate }} â‚ª.
          <br>
          * ×¡×”"×› ×œ×ª×©×œ×•× ×›×•×œ×œ ×›×•× × ×•×™×•×ª, × ×¡×™×¢×•×ª ×•×ª×•×¡×¤×•×ª.
        </div>
        
        <!-- ×›×œ×œ ×‘×™×˜×•×œ ×›×•× × ×•×ª -->
        <div style="margin-top: 16px; padding: 12px; background-color: #fef3c7; border: 1px solid #f59e0b; border-radius: 6px;">
          <h4 style="margin: 0 0 8px; color: #b45309; font-size: 14px;">ğŸ“‹ ×›×œ×œ ×‘×™×˜×•×œ ×›×•× × ×•×ª:</h4>
          <p style="margin: 0; font-size: 13px; color: #78350f;">
            ×× <strong>××¢×œ 70%</strong> ××–××Ÿ ×”×›×•× × ×•×ª ×—×•×¤×£ ×œ×©×¢×•×ª ×¢×‘×•×“×” ×‘×¤×•×¢×œ (×œ××©×œ, ×œ×™× ×” ×¢× ×“×™×™×¨ ××™×•×—×“), 
            ×”×›×•× × ×•×ª <strong>××‘×•×˜×œ×ª</strong> ×•×œ× ××©×•×œ××ª. ×‘××§×¨×” ×–×” ×”×¢×•×‘×“ ××§×‘×œ ×ª×©×œ×•× ×¨×§ ×¢×œ ×©×¢×•×ª ×”×¢×‘×•×“×” ×‘×¤×•×¢×œ.
          </p>
        </div>
        {% else %}
          <div class="muted">××™×Ÿ × ×ª×•× ×™× ×œ×—×•×“×© ×”× ×‘×—×¨.</div>
        {% endif %}
      </section>
    </div>
  </div>
</div>
<script>
  function toggleStandby() {
    const btn = document.getElementById('toggleStandbyBtn');
    const rows = document.querySelectorAll('.row-standby');
    
    // Check current state based on button text
    const isHiding = btn.innerText.includes('×”×¡×ª×¨');
    
    rows.forEach(row => {
      row.style.display = isHiding ? 'none' : 'table-row';
    });
    
    btn.innerText = isHiding ? '×”×¦×’ ×›×•× × ×•×™×•×ª' : '×”×¡×ª×¨ ×›×•× × ×•×™×•×ª';
    btn.style.opacity = isHiding ? '0.8' : '1';
  }
</script>
{% endblock %}

