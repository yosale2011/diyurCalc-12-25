# מערכת ניהול משמרות דיור

מערכת ווב מתקדמת לניהול משמרות, חישוב שכר וייצור דוחות עבור מדריכים בעמותת צהר. המערכת פותחה ב-FastAPI ותומכת בעבודה עם בסיס נתונים בענן (PostgreSQL) או מקומי (SQLite).

## תכונות עיקריות

- 📊 **ניהול משמרות**: תזמון וניהול משמרות מדריכים
- 💰 **חישוב שכר**: חישוב אוטומטי של שכר כולל תוספות, הפחתות ובונוסים
- 📈 **דוחות מקיפים**: יצירת דוחות שכר חודשיים ושנתיים
- 📧 **שליחת מיילים**: שליחת דוחות אוטומטית למדריכים
- 📱 **ממשק רספונסיבי**: עיצוב מודרני התומך במובייל
- ☁️ **עבודה בענן**: תמיכה מלאה בעבודה עם בסיס נתונים מרוחק
- 🔄 **ייצוא נתונים**: ייצוא ל-Excel ופורמטים נוספים
- 🎯 **התאמה אישית**: ניהול סמלי שכר והגדרות גמישות

## דרישות מערכת

- Python 3.8 ומעלה
- PostgreSQL (לעבודה בענן) או SQLite (לעבודה מקומית)
- 2GB RAM לפחות
- 500MB שטח דיסק פנוי

## התקנה והרצה מקומית

### 1. הורדת הפרויקט

```bash
git clone <repository-url>
cd diyur003
```

### 2. הגדרת סביבה וירטואלית

```bash
# יצירת סביבה וירטואלית
python -m venv venv

# הפעלת הסביה (Windows)
venv\Scripts\activate

# הפעלת הסביה (Linux/Mac)
source venv/bin/activate
```

### 3. התקנת תלות

```bash
pip install -r requirements.txt
```

### 4. הגדרת משתני סביבה

צור קובץ `.env` בתיקיית הפרויקט עם התוכן הבא:

```env
# הגדרות בסיס נתונים
DATABASE_URL=postgresql://username:password@localhost:5432/dbname
# או לבסיס נתונים מקומי:
# DATABASE_URL=sqlite:///./database.db

# הגדרות שרת
HOST=0.0.0.0
PORT=8000
DEBUG=False

# מפתח אבטחה (חובה לייצור)
SECRET_KEY=your-secret-key-here

# הגדרות נוספות
ENABLE_CACHING=True
CACHE_TIMEOUT=300
DEFAULT_MINIMUM_WAGE=34.40
```

### 5. הרצת האפליקציה

```bash
# אפשרות 1: עם Uvicorn (מומלץ לפיתוח)
uvicorn app:app --reload --host 0.0.0.0 --port 8000

# אפשרות 2: הרצה ישירה
python app.py
```

לאחר ההרצה, האפליקציה תהיה זמינה בכתובת: `http://localhost:8000`

## העלאה לאינטרנט

### אפשרות 1: Railway (מומלץ)

1. הירשם ל-[Railway](https://railway.app)
2. לחץ על "New Project" → "Deploy from GitHub repo"
3. העלה את הקוד ל-GitHub וחבר את החשבון
4. הגדר משתני סביבה בממשק Railway:
   - `DATABASE_URL`: כתובת בסיס הנתונים
   - `SECRET_KEY`: מפתח אבטחה ייחודי
5. Railway יזהה אוטומטית את ה-Procfile ויריץ את האפליקציה

### אפשרות 2: Render

1. הירשם ל-[Render](https://render.com)
2. צור Web Service חדש מ-repository של GitHub
3. הגדר את הפרמטרים הבאים:
   - **Build Command**: `pip install -r requirements.txt`
   - **Start Command**: `python -m uvicorn app:app --host 0.0.0.0 --port $PORT`
4. הגדר משתני סביבה בלוח הבקרה

### אפשרות 3: Fly.io

1. התקן את [flyctl](https://fly.io/docs/getting-started/installing-flyctl/)
2. הרץ: `fly launch`
3. עקוב אחר ההוראות

## מבנה הפרויקט

```
diyur003/
├── app.py              # קובץ האפליקציה הראשי
├── config.py           # הגדרות ומשתני סביבה
├── logic.py            # לוגיקה עסקית וחישובים
├── database.py         # התחברות לבסיס נתונים
├── routes/             # קבצי ניתוב
│   ├── home.py         # עמוד הבית
│   ├── guide.py        # ניהול מדריכים
│   ├── admin.py        # הגדרות מנהל
│   ├── summary.py      # סיכומי שכר
│   ├── export.py       # ייצוא נתונים
│   └── email.py        # שליחת מיילים
├── templates/          # תבניות HTML
├── static/             # קבצים סטטיים (CSS, JS, תמונות)
├── CSV/               # קבצי CSV לייבוא/ייצוא
├── tests/             # בדיקות יחידה
├── requirements.txt   # רשימת תלות
├── Procfile          # הגדרות הרצה לענן
└── .env              # משתני סביבה (לא נכלל בגיט)
```

## שימוש במערכת

### 1. הוספת מדריכים

- גישה לעמוד "ניהול מדריכים"
- הזנת פרטי המדריך (שם, מספר זהות, פרטי התקשרות)
- הגדרת תנאים ספציפיים למדריך

### 2. ניהול משמרות

- בחירת חודש ושנה
- הזנת משמרות לכל מדריך
- הגדרת סוגי משמרות (רגילה, שבת, חג)
- הוספת הערות והפחתות

### 3. חישוב שכר

- המערכת מחשבת אוטומטית:
  - שכר בסיס
  - תוספות שבת וחג
  - נסיעות
  - בונוסים והטבות
  - הפחתות (מס, ביטוח וכו')

### 4. ייצוא דוחות

- ייצוא ל-Excel
- ייצוא לפורמט גשר (להעברה למערכת שכר)
- שליחת דוחות במייל

## הגדרות מתקדמות

### הגדרת שרת SMTP למייל

```env
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USERNAME=your-email@gmail.com
SMTP_PASSWORD=your-app-password
SMTP_USE_TLS=True
EMAIL_FROM=your-email@gmail.com
```

### הגדרות מטמון

```env
ENABLE_CACHING=True
CACHE_TIMEOUT=300  # שניות
```

### הגדרות שכר

```env
DEFAULT_MINIMUM_WAGE=34.40
STANDARD_WORK_DAYS_PER_MONTH=21.66
MAX_SICK_DAYS_PER_MONTH=1.5
```

## פתרון בעיות נפוצות

### שגיאת חיבור לבסיס נתונים

1. בדוק את כתובת ה-DATABASE_URL בקובץ .env
2. ודא ששרת בסיס הנתונים פועל
3. בדוק את חומת האש והגדרות הרשת
4. לעבודה מקומית, ודא ש-PostgreSQL מותקן

### בעיות בהרצה

1. ודא שכל התלות מותקנת: `pip install -r requirements.txt`
2. בדוק גרסת Python: חייב להיות 3.8 ומעלה
3. ודא שהסביה הוירטואלית מופעלת

### בעיות בשליחת מייל

1. בדוק את הגדרות ה-SMTP
2. ודא שמשתמשים בסיסמת אפליקציה (ל-Gmail)
3. בדוק את תיקיית המיילים היוצאים (Spam)

## תמיכה ועדכונים

- גרסה נוכחית: 2.08
- עדכונים מתפרסמים דרך ה-repository
- לתמיכה: צור קשר דרך המייל המוסדי

## רישיון

פרויקט זה הוא קניין של עמותת צהר. כל הזכויות שמורות.

---

**הערה חשובה**: ודא שמגבות את בסיס הנתונים באופן קבוע, במיוחד בעבודה עם בסיס נתונים בענן.
